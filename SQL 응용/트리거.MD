# 트리거

- 데이터베이스 시스템에서 데이터의 삽입, 갱신, 삭제 등의 이벤트가 발생할 때 관련 작업이 자동으로 수행 되게 하는 절차형 SQL
- 트리거는 데이터베이스에 저장되며 데이터 변경 및 무결성 유지, 로그 메세지 출력 등의 목적으로 사용
- 트리거 문구에는 DCL(데이터 제어어)을 사용할 수없으며 , DCL이 포함된 프로시저나 함수를 호출하는 경우에도 오류가 발생함
- 트리거에 오류가 있는 경우 트리거가 처리하는 데이터에도 영향을 미치므로 트리거를 생성할 때 세심한 주의가 필요함



### 트리거의 구성도

```sql
DECLARE (필수)
EVENT (필수)
BEGIN (필수)
  CONTROL
  SQL
  EXCEPTION
END (필수)
```

- DECLARE : 트리거의 명칭, 변수 및 상수, 데이터 타입을 정의하는 선언부
- EVENT :  트리거가 싱행되는 조건을 명시
- BEGIN : 시작
- CONTROL : 조건문 또는 반복문이 삽입되어 순차적으로 처리된다
- SQL :  DML문이 삽입되어 데이터 관리를 위한 조회, 추가, 수정, 삭제 작업을 수행
- EXCEPTION : 예외가 발생하면 처리하는 구문



### 트리거의 생성

- CREATE TRIGGER 명령어를 사용한다

- 표기 형식

  ```sql
  CREATE [OR REPLACE] TRIGGER 트리거명 [동작시기 옵션][동작 옵션] ON 테이블명 REFERENCING [NEW|OLD] AS 테이블명
  FOR EACH ROW
  [WHEN 조건식]
  BEGIN
  	트리거 BODY;
  END;
  ```

- OR REPLACE : 시존의 트리거를 대체 가능한 예약어

- 동작시기 옵션 : 트리거 실행될 때를 지정한다

  - AFTER : 테이블이 변경된 후에 트리거가 실행된다
  - BEFORE 테이블이 변경되지 전에 트리거가 실행

- 동작 옵션 : 트리거가 실행되게 할 작업의 종류를 지정함. 옵션에는 INSERT, DELETE, UPDATE 있음

  - INSERT :  테이블에 새로운 튜플을 삽입할 때 트리거가 실행
  - DELETE : 테이블의 튜플을 삭제할 때 트리거가 실행
  - UPDATE :  테이블의 튜플을 수정할 때 트리거 실행

- NEW | OLD :  트리거가 적용될 테이블의 별칭을 지정함

  - NEW :  추가되거나 수정에 참여할 튜플들의 집합을 의미
  - OLD :  수정되거나 삭제 전 대상이 되는 튜플들의 집합

- FOR EACH ROW : 각 튜플마다 트리거를 적용한다는 의미

- WHEN 조건식 : 트리거를 적용할 튜플의 조건을 적용

- 트리거 BODY : 적어도 하나의 SQL문이 있어야 함



### 트리거의 제거

- DROP TRIGGER 명령어 사용
